<!doctype html>
<html lang="en">
<head>
			<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="icon" href="assets/logo-48.png">
		<link rel="apple-touch-icon" href="assets/apple-touch-180.png">
	<script>
	// List of valid bookmark output images (auto-generated)
	window.bookmarkOutputFiles = [
		"BOO-001_full.jpg","BOO-004_full.jpg","BOO-007_full.jpg","BOO-010_full.jpg","BOO-013_full.jpg","BOO-016_full.jpg","BOO-019_full.jpg","BOO-022_full.jpg","BOO-025_full.jpg","BOO-028_full.jpg","BOO-031_full.jpg","BOO-034_full.jpg","BOO-037_full.jpg","BOO-040_full.jpg","BOO-043_full.jpg","BOO-046_full.jpg","BOO-049_full.jpg","BOO-052_full.jpg","BOO-055_full.jpg","BOO-058_full.jpg","BOO-061_full.jpg","BOO-064_full.jpg","BOO-067_full.jpg","BOO-070_full.jpg","BOO-073_full.jpg","BOO-076_full.jpg","BOO-079_full.jpg","BOO-082_full.jpg","BOO-085_full.jpg","BOO-089_full.jpg","BOO-093_full.jpg","BOO-097_full.jpg","BOO-101_full.jpg","BOO-105_full.jpg","BOO-109_full.jpg","BOO-112_full.jpg","BOO-116_full.jpg","BOO-120_full.jpg","BOO-124_full.jpg","BOO-128_full.jpg","BOO-132_full.jpg","BOO-136_full.jpg","BOO-140_full.jpg","BOO-144_full.jpg","BOO-148_full.jpg","BOO-152_full.jpg","BOO-155_full.jpg","BOO-159_full.jpg","BOO-163_full.jpg","BOO-167_full.jpg","BOO-171_full.jpg","BOO-175_full.jpg","BOO-179_full.jpg","BOO-183_full.jpg","BOO-187_full.jpg","BOO-191_full.jpg","BOO-195_full.jpg","BOO-198_full.jpg","BOO-202_full.jpg","BOO-206_full.jpg","BOO-210_full.jpg","BOO-214_full.jpg","BOO-218_full.jpg","BOO-222_full.jpg","BOO-226_full.jpg","BOO-230_full.jpg","BOO-234_full.jpg","BOO-238_full.jpg","BOO-241_full.jpg","BOO-245_full.jpg","BOO-249_full.jpg","BOO-253_full.jpg","BOO-257_full.jpg","BOO-261_full.jpg","BOO-265_full.jpg","BOO-275_full.jpg","BOO-278_full.jpg","BOO-281_full.jpg","BOO-284_full.jpg","BOO-287_full.jpg","BOO-290_full.jpg","BOO-293_full.jpg","BOO-296_full.jpg","BOO-299_full.jpg","BOO-302_full.jpg","BOO-305_full.jpg","BOO-308_full.jpg","BOO-311_full.jpg","BOO-314_full.jpg","BOO-317_full.jpg","BOO-320_full.jpg","BOO-323_full.jpg","BOO-326_full.jpg","BOO-329_full.jpg","BOO-332_full.jpg","BOO-335_full.jpg","BOO-338_full.jpg","BOO-341_full.jpg","BOO-344_full.jpg","BOO-347_full.jpg","BOO-350_full.jpg","BOO-353_full.jpg","BOO-356_full.jpg","BOO-359_full.jpg","BOO-362_full.jpg","BOO-365_full.jpg","BOO-368_full.jpg","BOO-371_full.jpg","BOO-374_full.jpg","BOO-377_full.jpg","BOO-380_full.jpg","BOO-383_full.jpg","BOO-386_full.jpg","BOO-389_full.jpg","BOO-392_full.jpg","BOO-395_full.jpg","BOO-398_full.jpg","BOO-401_full.jpg","BOO-404_full.jpg","BOO-407_full.jpg","BOO-410_full.jpg","BOO-413_full.jpg","BOO-416_full.jpg","BOO-419_full.jpg","BOO-422_full.jpg","BOO-425_full.jpg","BOO-428_full.jpg","BOO-431_full.jpg","BOO-434_full.jpg","BOO-437_full.jpg","BOO-440_full.jpg","BOO-443_full.jpg","BOO-446_full.jpg","BOO-449_full.jpg","BOO-452_full.jpg","BOO-455_full.jpg","BOO-458_full.jpg","BOO-461_full.jpg","BOO-464_full.jpg","BOO-467_full.jpg","BOO-470_full.jpg","BOO-473_full.jpg","BOO-476_full.jpg","BOO-479_full.jpg","BOO-482_full.jpg","BOO-485_full.jpg","BOO-488_full.jpg","BOO-491_full.jpg","BOO-494_full.jpg","BOO-497_full.jpg","BOO-500_full.jpg","BOO-503_full.jpg","BOO-506_full.jpg","BOO-509_full.jpg","BOO-512_full.jpg","BOO-515_full.jpg","BOO-518_full.jpg","BOO-521_full.jpg","BOO-524_full.jpg","BOO-527_full.jpg","BOO-530_full.jpg","BOO-533_full.jpg","BOO-536_full.jpg","BOO-539_full.jpg","BOO-542_full.jpg","BOO-545_full.jpg","BOO-548_full.jpg","BOO-551_full.jpg","BOO-554_full.jpg","BOO-557_full.jpg","BOO-560_full.jpg","BOO-563_full.jpg","BOO-566_full.jpg","BOO-569_full.jpg","BOO-572_full.jpg","BOO-575_full.jpg","BOO-578_full.jpg","BOO-581_full.jpg","BOO-584_full.jpg","BOO-587_full.jpg","BOO-590_full.jpg","BOO-593_full.jpg","BOO-596_full.jpg","BOO-599_full.jpg","BOO-602_full.jpg","BOO-605_full.jpg","BOO-608_full.jpg","BOO-611_full.jpg","BOO-614_full.jpg","BOO-617_full.jpg","BOO-620_full.jpg","BOO-623_full.jpg","BOO-626_full.jpg","BOO-629_full.jpg","BOO-632_full.jpg","BOO-635_full.jpg","BOO-638_full.jpg","BOO-641_full.jpg","BOO-644_full.jpg","BOO-647_full.jpg","BOO-650_full.jpg","BOO-653_full.jpg","BOO-656_full.jpg","BOO-659_full.jpg","BOO-662_full.jpg","BOO-665_full.jpg","BOO-668_full.jpg","BOO-671_full.jpg","BOO-674_full.jpg","BOO-677_full.jpg","BOO-680_full.jpg","BOO-683_full.jpg","BOO-686_full.jpg","BOO-689_full.jpg","BOO-692_full.jpg","BOO-695_full.jpg","BOO-698_full.jpg","BOO-701_full.jpg","BOO-704_full.jpg","BOO-707_full.jpg","BOO-710_full.jpg","BOO-713_full.jpg","BOO-716_full.jpg","BOO-719_full.jpg","BOO-722_full.jpg","BOO-725_full.jpg","BOO-728_full.jpg","BOO-731_full.jpg","BOO-734_full.jpg","BOO-737_full.jpg","BOO-740_full.jpg","BOO-743_full.jpg","BOO-746_full.jpg","BOO-749_full.jpg","BOO-752_full.jpg"
	];
	</script>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Poster Point</title>
	<link rel="stylesheet" href="styles.shop.css">
	<style>
		   /* Enhanced Responsive Overrides */

		   /* Tablet/Medium Screens (max-width: 900px) */
		   @media (max-width: 900px) {
			   .app { flex-direction: column; }
			   .sidebar {
				   width: 100vw;
				   max-width: 100vw;
				   left: 0 !important;
				   right: 0 !important;
				   border-radius: 0 0 12px 12px;
				   min-width: unset;
				   box-shadow: 0 6px 30px rgba(0,0,0,0.4);
			   }
			   .sidebar.sidebar-right {
				   right: 0;
				   left: auto;
			   }
			   .main {
				   margin-left: 0;
				   margin-right: 0;
			   }
			   #product-grid, .grid {
				   grid-template-columns: repeat(2, 1fr) !important;
				   gap: 14px;
			   }
			   header.header {
				   flex-wrap: wrap;
				   gap: 8px;
				   padding: 10px 8px;
			   }
			   .logo .title { font-size: 17px; }
			   .logo .sub { font-size: 10px; }
			   .content { padding: 12px; }
			   .card .thumb { height: 200px; }
			   .card { padding: 12px; }
			   .offer-banner { font-size: 15px; padding: 10px 8px; }
			   #cart-sidebar { width: 100vw; right: 0; left: 0; border-radius: 0 0 12px 12px; }
		   }

		   /* Mobile Screens (max-width: 640px) */
		   @media (max-width: 640px) {
			   .app { flex-direction: column; }
			   .sidebar {
				   width: 100vw;
				   max-width: 100vw;
				   left: 0 !important;
				   right: 0 !important;
				   border-radius: 0 0 12px 12px;
				   min-width: unset;
				   box-shadow: 0 6px 30px rgba(0,0,0,0.3);
				   padding: 12px 6px;
			   }
			   .sidebar.sidebar-right {
				   right: 0;
				   left: auto;
			   }
			   .main {
				   margin-left: 0;
				   margin-right: 0;
			   }
			   #product-grid, .grid {
				   grid-template-columns: 1fr !important;
				   gap: 10px;
				   margin: 0 2vw;
				   padding: 0;
			   }
			   .card {
				   margin: 0 0 10px 0;
				   padding: 10px;
			   }
			   .card .thumb {
				   height: 140px;
			   }
			   .logo .title { font-size: 15px; }
			   .logo .sub { font-size: 9px; }
			   header.header {
				   flex-wrap: wrap;
				   gap: 6px;
				   padding: 7px 4px;
			   }
			   .content { padding: 6px; }
			   .offer-banner { font-size: 13px; padding: 7px 4px; }
			   #cart-sidebar { width: 100vw; right: 0; left: 0; border-radius: 0 0 12px 12px; padding: 10px 4px; }
			   .sidebar .brand-small, .sidebar .side-head, .sidebar .other-header, .sidebar .other-title {
				   font-size: 13px;
			   }
			   .sidebar .cat-list li a { font-size: 13px; }
			   .sidebar .cat-list li { padding: 6px 2px; }
			   .sidebar .cat-list { gap: 2px; }
			   .sidebar .icon svg { width: 14px; height: 14px; }
			   .testimonial-carousel { padding: 8px; }
			   .testimonial-carousel button { width: 32px; height: 32px; font-size: 12px; }
			   #newsletter-form input { max-width: 100%; }
			   .title.large { font-size: 1.5em; }
			   /* Modal adjustments */
			   #detail-modal > div:nth-child(2) {
				   max-width: 98vw !important;
				   margin: 10vw auto !important;
				   padding: 8px !important;
			   }
			   #detail-modal .thumb, #detail-image { min-height: 120px !important; }
			   #detail-modal h2 { font-size: 1.1em; }
			   #detail-modal p, #detail-modal label, #detail-modal .button { font-size: 13px; }
			   #detail-modal .button { padding: 8px 10px; }
			   #detail-modal [style*="display:flex;gap:20px"] { flex-direction: column !important; gap: 8px !important; }
			   #detail-image, #detail-modal [style*="flex:1;max-width:50%"] { max-width: 100% !important; min-width: 0 !important; }
		   }
		:root{ --bg:#000; --fg:#fff; --muted:#bbb; --accent:#222; --main-accent:#2b2b2b; --other-accent:#151515; --text:#eaeaea; --accent2:#fff176 }
		html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:Inter,Segoe UI,Arial,sans-serif}
		a{color:inherit;text-decoration:none}
		.app{display:flex;min-height:100vh}

		/* Sidebar (off-canvas left & right) */
		.sidebar{width:260px;background:var(--accent);padding:20px 16px;box-sizing:border-box;box-shadow:0 6px 30px rgba(0,0,0,0.6);position:fixed;top:0;bottom:0;transform:translateX(-300px);transition:transform .28s ease;z-index:70}
		.sidebar.open{transform:translateX(0)}
		.sidebar.sidebar-right{right:0;left:auto;transform:translateX(300px)}
		.sidebar.sidebar-right.open{transform:translateX(0)}
		.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);opacity:0;visibility:hidden;transition:opacity .2s ease;z-index:65}
		.overlay.show{opacity:1;visibility:visible}

		/* Mobile cart open indicator (small banner shown when cart opens on phones) */
		#cart-mobile-indicator{position:fixed;left:12px;right:12px;bottom:18px;background:linear-gradient(90deg,#111,#222);color:var(--fg);padding:10px 14px;border-radius:10px;text-align:center;font-weight:700;z-index:95;display:none;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
		body.cart-open-mobile #cart-mobile-indicator{display:block;animation:cartIndicatorIn .22s ease}
		@keyframes cartIndicatorIn{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}

		/* Sidebars float (overlay) */
		.main{transition:none}
		.brand-small{font-weight:700;font-size:14px;margin-bottom:18px;letter-spacing:0.6px}
		.side-head{font-size:18px;font-weight:700;margin:14px 0 8px}
		.cat-list{list-style:none;padding:0;margin:0}
		.cat-list li{padding:8px 6px;border-radius:6px;margin-bottom:6px}
		.cat-list li a{display:block;padding:6px 8px;border-radius:6px}
		.cat-list li a:hover{background:rgba(255,255,255,0.03)}
		/* main (left) sidebar accents */
		#main-sidebar{border-right:1px solid rgba(255,255,255,0.02)}
		/* main category buttons: modern, borderless, subtle hover */
		.head-btn{display:flex;align-items:center;gap:10px;width:100%;background:transparent;border:0;color:var(--fg);padding:8px 6px;font-weight:700;font-size:15px;text-align:left;cursor:pointer;border-radius:6px;transition:transform .18s ease, color .18s ease, background .18s ease}
		.head-btn:focus{outline:2px solid rgba(255,255,255,0.06);outline-offset:2px}
		.head-btn:hover{transform:translateX(6px);background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#fff}
		.head-btn .icon svg{transition:transform .22s ease, stroke .18s ease}
		.head-btn:hover .icon svg{transform:translateX(2px) rotate(4deg)}
		/* other (right) sidebar accents */
		#other-sidebar{border-left:1px solid rgba(255,255,255,0.02)}
		#other-sidebar .cat-list li a:hover{background:rgba(255,255,255,0.02);color:var(--fg);}
		.cat-list .icon{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;margin-right:8px;flex:0 0 18px}
		.icon svg{width:16px;height:16px;display:block}
		.icon-main svg{fill:transparent;stroke:var(--fg);stroke-width:1.2}
		.icon-other svg{fill:var(--muted);stroke:none}

		/* Main content area */
		.main{flex:1;display:flex;flex-direction:column;margin-left:0}
		header.header{display:flex;align-items:center;gap:18px;padding:14px 20px;border-bottom:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);position:relative;z-index:10}

		/* Header menu button */
		.menu-btn{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;margin-right:6px}
		.other-btn{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;margin-right:6px}

		.logo{display:flex;flex-direction:column}
		.logo .title{font-size:20px;font-weight:800;line-height:1}
		.logo .sub{font-size:11px;color:var(--muted);margin-top:4px}

		.search-wrap{margin-left:12px;flex:1;max-width:680px}
		.search{display:flex;align-items:center;background:#0b0b0b;border:1px solid rgba(255,255,255,0.08);padding:8px;border-radius:8px}
		.search input{flex:1;background:transparent;border:0;color:var(--fg);outline:none;padding:6px 8px;font-size:14px}
		.search input::placeholder{color:var(--muted)}
		.search button{background:transparent;border:0;color:var(--muted);cursor:pointer;padding:6px}

		.header-actions{display:flex;align-items:center;gap:12px;margin-left:auto}
		.header-actions{display:flex;align-items:center;gap:12px;margin-left:auto;position:relative;z-index:90}
		.cart{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;z-index:91}

		.content{padding:22px;flex:1;overflow:auto}
			.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
				.card .thumb{height:300px;border-radius:6px;background:linear-gradient(180deg,#111,#0a0a0a);display:flex;align-items:flex-end;justify-content:flex-start;padding:10px;color:var(--muted);font-weight:700}
			.card .title{font-size:14px;margin:8px 0 12px}
			.card .actions{display:flex;gap:8px}
			.button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--fg);padding:8px 10px;border-radius:6px;cursor:pointer}
			.button.primary{background:var(--fg);color:var(--bg);border-color:transparent}
			.button:active{transform:translateY(1px)}
			.card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);text-align:center;transition:transform 260ms ease}
			.card:hover{transform:translateY(-6px)}
			.btn{background:var(--fg);color:var(--bg);border:0;padding:10px 20px;border-radius:8px;cursor:pointer}
			.btn.ghost{background:transparent;color:var(--fg);border:1px solid rgba(255,255,255,0.06)}
		.card h4{margin:0 0 8px}

		/* Responsive */
		@media (max-width:800px){
			.sidebar{display:block}
			.search-wrap{max-width:unset}
		}
			@media (prefers-reduced-motion:reduce){.sidebar{transition:none}.overlay{transition:none}}
			/* Right sidebar entrance animations for items */
			@keyframes itemEnter{
				from{opacity:0;transform:translateX(10px)}
				to{opacity:1;transform:translateX(0)}
			}


			/* other sidebar title */
			.other-header{padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.03);margin-bottom:12px}
			.other-title{font-size:16px;font-weight:800;color:var(--fg);margin-top:6px}
			.brand-small{font-size:12px;color:var(--muted);margin:0}

			/* Cart sidebar */
			#cart-sidebar{width:360px;right:-380px;padding:20px;box-sizing:border-box;z-index:80;border-left:1px solid rgba(255,255,255,0.02);}
			#cart-sidebar.open{transform:translateX(-380px)}
			#cart-sidebar .cart-list{list-style:none;padding:0;margin:0;max-height:50vh;overflow:auto}
			#cart-sidebar .cart-item{display:flex;align-items:center;gap:10px;padding:10px 6px;border-bottom:1px solid rgba(255,255,255,0.03)}
			#cart-sidebar .cart-item .ci-name{font-weight:700}
			#cart-sidebar .cart-summary{margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.03)}
			       /* Tablet/Medium Screens (max-width: 900px) */
       @media (max-width: 900px) {
           .app { flex-direction: column; }
           .sidebar {
               width: 100vw;
               max-width: 100vw;
               left: 0 !important;
               right: 0 !important;
               border-radius: 0 0 12px 12px;
               min-width: unset;
               box-shadow: 0 6px 30px rgba(0,0,0,0.4);
               /* FIX: Use Y-transform for mobile/tablet slide-down effect, 
               and hide by default to fix automatic visibility. */
               transform: translateY(-100vh) !important;
               top: 0;
               bottom: auto; /* Allow content height to dictate size */
               max-height: 90vh; /* Better mobile UX */
           }
           /* NEW: All 'open' sidebars slide down */
           .sidebar.open {
               transform: translateY(0) !important;
           }
           /* Remove sidebar-right specific overrides for mobile now handled by generic .sidebar */
           .sidebar.sidebar-right {
               /* No need for right/left overrides here anymore */
               right: 0;
               left: auto;
           }
           .main {
               margin-left: 0;
               margin-right: 0;
           }
           #product-grid, .grid {
               grid-template-columns: repeat(2, 1fr) !important;
               gap: 14px;
           }
           header.header {
               flex-wrap: wrap;
               gap: 8px;
               padding: 10px 8px;
           }
           .logo .title { font-size: 17px; }
           .logo .sub { font-size: 10px; }
           .content { padding: 12px; }
           .card .thumb { height: 200px; }
           .card { padding: 12px; }
           .offer-banner { font-size: 15px; padding: 10px 8px; }
           #cart-sidebar {
               width: 100vw;
               right: 0;
               left: 0;
               border-radius: 0 0 12px 12px;
               top: 0; /* Anchor to top */
               bottom: auto; /* Reset bottom */
           }
       }

       /* Mobile Screens (max-width: 640px) */
       @media (max-width: 640px) {
           .app { flex-direction: column; }
           .sidebar {
               /* Inherits new transform from 900px media query */
               width: 100vw;
               max-width: 100vw;
               left: 0 !important;
               right: 0 !important;
               border-radius: 0 0 12px 12px;
               min-width: unset;
               box-shadow: 0 6px 30px rgba(0,0,0,0.3);
               padding: 12px 6px;
           }
           /* Remove sidebar-right specific overrides for mobile now handled by generic .sidebar */
           .sidebar.sidebar-right {
               right: 0;
               left: auto;
           }
           .main {
               margin-left: 0;
               margin-right: 0;
           }
           #product-grid, .grid {
               grid-template-columns: 1fr !important;
               gap: 10px;
               margin: 0 2vw;
               padding: 0;
           }
           .card {
               margin: 0 0 10px 0;
               padding: 10px;
           }
           .card .thumb {
               height: 140px;
           }
           .logo .title { font-size: 15px; }
           .logo .sub { font-size: 9px; }
           header.header {
               flex-wrap: wrap;
               gap: 6px;
               padding: 7px 4px;
           }
           .content { padding: 6px; }
           .offer-banner { font-size: 13px; padding: 7px 4px; }
           #cart-sidebar { width: 100vw; right: 0; left: 0; border-radius: 0 0 12px 12px; padding: 10px 4px; top: 0; bottom: auto; }
           .sidebar .brand-small, .sidebar .side-head, .sidebar .other-header, .sidebar .other-title {
               font-size: 13px;
           }
           .sidebar .cat-list li a { font-size: 13px; }
           .sidebar .cat-list li { padding: 6px 2px; }
           .sidebar .cat-list { gap: 2px; }
           .sidebar .icon svg { width: 14px; height: 14px; }
           .testimonial-carousel { padding: 8px; }
           .testimonial-carousel button { width: 32px; height: 32px; font-size: 12px; }
           #newsletter-form input { max-width: 100%; }
           .title.large { font-size: 1.5em; }
           /* Modal adjustments */
           #detail-modal > div:nth-child(2) {
               max-width: 98vw !important;
               margin: 10vw auto !important;
               padding: 8px !important;
           }
           #detail-modal .thumb, #detail-image { min-height: 120px !important; }
           #detail-modal h2 { font-size: 1.1em; }
           #detail-modal p, #detail-modal label, #detail-modal .button { font-size: 13px; }
           #detail-modal .button { padding: 8px 10px; }
           #detail-modal [style*="display:flex;gap:20px"] { flex-direction: column !important; gap: 8px !important; }
           #detail-image, #detail-modal [style*="flex:1;max-width:50%"] { max-width: 100% !important; min-width: 0 !important; }
       }
    :root{ --bg:#000; --fg:#fff; --muted:#bbb; --accent:#222; --main-accent:#2b2b2b; --other-accent:#151515; --text:#eaeaea; --accent2:#fff176 }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:Inter,Segoe UI,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .app{display:flex;min-height:100vh}

    /* Sidebar (off-canvas left & right) */
    .sidebar{width:260px;background:var(--accent);padding:20px 16px;box-sizing:border-box;box-shadow:0 6px 30px rgba(0,0,0,0.6);position:fixed;top:0;bottom:0;transform:translateX(-300px);transition:transform .28s ease;z-index:70}
    .sidebar.open{transform:translateX(0)}
    .sidebar.sidebar-right{right:0;left:auto;transform:translateX(300px)}
    .sidebar.sidebar-right.open{transform:translateX(0)}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);opacity:0;visibility:hidden;transition:opacity .2s ease;z-index:65}
    .overlay.show{opacity:1;visibility:visible}

    /* Mobile cart open indicator (small banner shown when cart opens on phones) */
    #cart-mobile-indicator{position:fixed;left:12px;right:12px;bottom:18px;background:linear-gradient(90deg,#111,#222);color:var(--fg);padding:10px 14px;border-radius:10px;text-align:center;font-weight:700;z-index:95;display:none;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    body.cart-open-mobile #cart-mobile-indicator{display:block;animation:cartIndicatorIn .22s ease}
    @keyframes cartIndicatorIn{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}

    /* Sidebars float (overlay) */
    .main{transition:none}
    .brand-small{font-weight:700;font-size:14px;margin-bottom:18px;letter-spacing:0.6px}
    .side-head{font-size:18px;font-weight:700;margin:14px 0 8px}
    .cat-list{list-style:none;padding:0;margin:0}
    .cat-list li{padding:8px 6px;border-radius:6px;margin-bottom:6px}
    .cat-list li a{display:block;padding:6px 8px;border-radius:6px}
    .cat-list li a:hover{background:rgba(255,255,255,0.03)}
    /* main (left) sidebar accents */
    #main-sidebar{border-right:1px solid rgba(255,255,255,0.02)}
    /* main category buttons: modern, borderless, subtle hover */
    .head-btn{display:flex;align-items:center;gap:10px;width:100%;background:transparent;border:0;color:var(--fg);padding:8px 6px;font-weight:700;font-size:15px;text-align:left;cursor:pointer;border-radius:6px;transition:transform .18s ease, color .18s ease, background .18s ease}
    .head-btn:focus{outline:2px solid rgba(255,255,255,0.06);outline-offset:2px}
    .head-btn:hover{transform:translateX(6px);background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#fff}
    .head-btn .icon svg{transition:transform .22s ease, stroke .18s ease}
    .head-btn:hover .icon svg{transform:translateX(2px) rotate(4deg)}
    /* other (right) sidebar accents */
    #other-sidebar{border-left:1px solid rgba(255,255,255,0.02)}
    #other-sidebar .cat-list li a:hover{background:rgba(255,255,255,0.02);color:var(--fg);}
    .cat-list .icon{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;margin-right:8px;flex:0 0 18px}
    .icon svg{width:16px;height:16px;display:block}
    .icon-main svg{fill:transparent;stroke:var(--fg);stroke-width:1.2}
    .icon-other svg{fill:var(--muted);stroke:none}

    /* Main content area */
    .main{flex:1;display:flex;flex-direction:column;margin-left:0}
    header.header{display:flex;align-items:center;gap:18px;padding:14px 20px;border-bottom:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);position:relative;z-index:10}

    /* Header menu button */
    .menu-btn{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;margin-right:6px}
    .other-btn{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;margin-right:6px}

    .logo{display:flex;flex-direction:column}
    .logo .title{font-size:20px;font-weight:800;line-height:1}
    .logo .sub{font-size:11px;color:var(--muted);margin-top:4px}

    .search-wrap{margin-left:12px;flex:1;max-width:680px}
    .search{display:flex;align-items:center;background:#0b0b0b;border:1px solid rgba(255,255,255,0.08);padding:8px;border-radius:8px}
    .search input{flex:1;background:transparent;border:0;color:var(--fg);outline:none;padding:6px 8px;font-size:14px}
    .search input::placeholder{color:var(--muted)}
    .search button{background:transparent;border:0;color:var(--muted);cursor:pointer;padding:6px}

    .header-actions{display:flex;align-items:center;gap:12px;margin-left:auto}
    .header-actions{display:flex;align-items:center;gap:12px;margin-left:auto;position:relative;z-index:90}
    .cart{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;z-index:91}

    .content{padding:22px;flex:1;overflow:auto}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px}
            .card .thumb{height:300px;border-radius:6px;background:linear-gradient(180deg,#111,#0a0a0a);display:flex;align-items:flex-end;justify-content:flex-start;padding:10px;color:var(--muted);font-weight:700}
        .card .title{font-size:14px;margin:8px 0 12px}
        .card .actions{display:flex;gap:8px}
        .button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--fg);padding:8px 10px;border-radius:6px;cursor:pointer}
        .button.primary{background:var(--fg);color:var(--bg);border-color:transparent}
        .button:active{transform:translateY(1px)}
        .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);text-align:center;transition:transform 260ms ease}
        .card:hover{transform:translateY(-6px)}
        .btn{background:var(--fg);color:var(--bg);border:0;padding:10px 20px;border-radius:8px;cursor:pointer}
        .btn.ghost{background:transparent;color:var(--fg);border:1px solid rgba(255,255,255,0.06)}
    .card h4{margin:0 0 8px}

    /* Responsive */
    @media (max-width:800px){
        .sidebar{display:block}
        .search-wrap{max-width:unset}
    }
        @media (prefers-reduced-motion:reduce){.sidebar{transition:none}.overlay{transition:none}}
        /* Right sidebar entrance animations for items */
        @keyframes itemEnter{
            from{opacity:0;transform:translateX(10px)}
            to{opacity:1;transform:translateX(0)}
        }


        /* other sidebar title */
        .other-header{padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.03);margin-bottom:12px}
        .other-title{font-size:16px;font-weight:800;color:var(--fg);margin-top:6px}
        .brand-small{font-size:12px;color:var(--muted);margin:0}

        /* Cart sidebar */
        #cart-sidebar{width:360px;right:-380px;padding:20px;box-sizing:border-box;z-index:80;border-left:1px solid rgba(255,255,255,0.02);}
        /* On desktop, cart slides in from right using translateX */
        #cart-sidebar.open{transform:translateX(-380px)}
        #cart-sidebar .cart-list{list-style:none;padding:0;margin:0;max-height:50vh;overflow:auto}
        #cart-sidebar .cart-item{display:flex;align-items:center;gap:10px;padding:10px 6px;border-bottom:1px solid rgba(255,255,255,0.03)}
        #cart-sidebar .cart-item .ci-name{font-weight:700}
        #cart-sidebar .cart-summary{margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.03)}
</style>
	</style>
</head>
<body>
	<div class="app">
			<aside class="sidebar" id="main-sidebar" aria-hidden="true">
			<div class="brand-small">Poster Point</div>
			<div class="side-head">Head Categories</div>
				<ul class="cat-list">
					<li>
						<button class="head-btn" data-key="posters" aria-expanded="false">
							<span class="icon icon-main" aria-hidden>
								<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="4" width="18" height="16" rx="1.5"/></svg>
							</span>
							Posters
						</button>
					</li>
					<li>
						<button class="head-btn" data-key="stickers" aria-expanded="false">
							<span class="icon icon-main" aria-hidden>
								<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="12" height="12" rx="1"/><path d="M16 8l4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
							</span>
							Stickers
						</button>
					</li>
					<li>
						<button class="head-btn" data-key="bookmarks" aria-expanded="false">
							<span class="icon icon-main" aria-hidden>
								<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2h12v20l-6-4-6 4V2z"/></svg>
							</span>
							Bookmarks
						</button>
					</li>
				</ul>
			</aside>

			<aside class="sidebar sidebar-right" id="cart-sidebar" aria-hidden="true">
				   <div class="other-header" style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
					   <div>
						   <div class="brand-small">Cart</div>
						   <div class="other-title">Your Cart</div>
					   </div>
					   <button id="back-to-shop" class="button" style="font-size:13px;padding:6px 14px;">Back to Shop</button>
				   </div>
				<ul id="cart-items" class="cart-list">
					</ul>
				   <div class="cart-summary">
					   <div id="cart-totals"></div>
					   <div style="margin-top:10px;display:flex;gap:8px">
						   <button id="whatsapp-share" class="button primary" style="background-color:#25D366;color:#fff;border:none;">Share on WhatsApp</button>
						   <button id="clear-cart" class="button">Clear</button>
					   </div>
					   <div style="margin-top:14px;font-size:12px;color:#ffecb3;background:#222;padding:8px 10px;border-radius:6px;">
						   <strong>Disclaimer:</strong> Offers apply for every multiple of the required quantity (e.g., Buy 3 Get 1 Free applies across *all* items in the same category like Posters). Add more to get more free items!<br>
					   </div>
				   </div>
			</aside>

			<aside class="sidebar sidebar-right" id="other-sidebar" aria-hidden="true">
				<div class="other-header">
					<div class="brand-small">Other</div>
					<div id="other-title" class="other-title">Posters</div>
				</div>
				<ul id="other-list" class="cat-list">
					</ul>
			</aside>

		<div class="overlay" id="sidebar-overlay" tabindex="-1" aria-hidden="true"></div>

		<div class="main">
			<header class="header">
				<button class="menu-btn" id="menu-toggle" aria-label="Open main categories" aria-controls="main-sidebar" aria-expanded="false">
					<svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
						<rect width="18" height="2" rx="1" fill="white"/>
						<rect y="6" width="18" height="2" rx="1" fill="white"/>
						<rect y="12" width="18" height="2" rx="1" fill="white"/>
					</svg>
				</button>



				   <button id="home-btn" class="button" style="margin-right:16px;font-size:15px;padding:7px 18px;">Home</button>
				   <div class="logo" style="display:flex;align-items:center;gap:10px;">
					   <img src="assets/logo-48.png" srcset="assets/logo-96.png 2x" alt="Poster Point logo" style="height:40px;width:40px;border-radius:8px;box-shadow:0 2px 8px #0002;background:#fff;">
					   <div class="title">Poster Point</div>
					   <div class="sub">high quality posters,stickers,bookmarks etc</div>
				   </div>

				<div class="search-wrap">
					<form class="search" action="#" onsubmit="event.preventDefault();">
						<input type="search" placeholder="search posters,stickers,bookmarks" aria-label="Search">
						<button title="Search">üîç</button>
					</form>
				</div>

				   <div class="header-actions">
					   <button class="cart" title="View cart" aria-label="Cart" style="position:relative;">
						   <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
							   <path d="M6 6H21L20 12H8L6 6Z" stroke="white" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
							   <path d="M7 18a1 1 0 1 0 0 2 1 1 0 0 0 0-2zM17 18a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" fill="white"/>
						   </svg>
						   <span id="cart-count" style="position:absolute;top:-7px;right:-7px;background:#fff;color:#111;font-size:12px;font-weight:700;padding:2px 7px;border-radius:12px;min-width:22px;text-align:center;display:none;z-index:2;box-shadow:0 1px 4px rgba(0,0,0,0.13);"></span>
					   </button>
				   </div>
			</header>

			   <main class="content">
				   <div class="offer-banner" style="background:linear-gradient(90deg,#222,#111);color:#fff;padding:16px 18px;border-radius:8px;margin-bottom:18px;font-size:17px;font-weight:700;box-shadow:0 2px 12px rgba(0,0,0,0.12);text-align:center;letter-spacing:0.5px;">
					   üéâ Special Offer: Buy 3 Get 1 Free, Buy 5 Get 2 Free, Buy 10 Get 5 Free! Add more to your cart and save big on posters, stickers, and bookmarks! üéâ
				   </div>
				   <div class="grid" id="catalog-grid">
					   </div>
			   </main>
		</div>
	</div>
	<script>
		(function(){
			// --- Global Constants and Configuration ---

			// Price map: updated to match user request
			const priceMap = {
				posters: {
					Pocket: 10,
					A6: 19,
					A5: 25,
					A4: 39,
					A3: 69
				},
				   stickers: {
					   'Single': 9,
					   'A4 (Full)': 99,
					   'A3 (Full)': 179
				   },
				bookmarks: {
					Default: 20
				}
			};

			// Path configurations (adjust these as needed for your file system)
			const outputsFallback = 'output-fallback.jpg'; // Path to a generic fallback image
			const imagesFolderRelative = 'images/PINTEREST%20IMAGES/'; // Base relative path for stickers/bookmarks folders

			// Local base folder (Required for the local file path logic in openDetails)
			// *** CRITICAL: Update this path to your actual local folder if using file:// protocol ***
			const localBase = 'C:/Users/Prati/OneDrive/Desktop/webiste index/images/';


			// --- DOM Elements ---
			const mainSidebar = document.getElementById('main-sidebar');
			const otherSidebar = document.getElementById('other-sidebar');
			const cartSidebar = document.getElementById('cart-sidebar');
			const toggle = document.getElementById('menu-toggle');
			const overlay = document.getElementById('sidebar-overlay');
			const catalogGrid = document.getElementById('catalog-grid');
			const cartBtn = document.querySelector('.cart');
			const otherList = document.getElementById('other-list');

			// Cart Elements
			const cartItemsEl = document.getElementById('cart-items');
			const cartTotalsEl = document.getElementById('cart-totals');

			let prevFocused = null;
			let cart = []; // {id, name, category, price, qty, file, folder, size}

			// --- Accessibility & Focus Trap Helpers ---

			function getFocusable(container){
				return Array.from(container.querySelectorAll('a, button, input, select, [tabindex]:not([tabindex="-1"])')).filter(el=>!el.hasAttribute('disabled'));
			}

			function activateTrap(container){
				const focusable = getFocusable(container);
				if(!focusable.length) return;
				prevFocused = document.activeElement;
				// Focus the first focusable element inside the container
				focusable[0].focus();
				container.__trapHandler = function(e){
					if(e.key === 'Tab'){
						const first = focusable[0], last = focusable[focusable.length-1];
						if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
						else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
					} else if(e.key === 'Escape'){
						closeMain(); closeOther(); closeCart(); closeDetails();
					}
				};
				document.addEventListener('keydown', container.__trapHandler);
			}

			function deactivateTrap(container){
				if(container && container.__trapHandler){
					document.removeEventListener('keydown', container.__trapHandler);
					delete container.__trapHandler;
				}
				if(prevFocused) { try{ prevFocused.focus(); }catch(e){} prevFocused = null; }
			}

			// --- Sidebar Control Functions ---

			function openMain(){
				mainSidebar.classList.add('open');
				mainSidebar.setAttribute('aria-hidden','false');
				toggle.setAttribute('aria-expanded','true');
				closeOther();
				closeCart();
				overlay.classList.add('show');
				activateTrap(mainSidebar);
			}

			function closeMain(){
				mainSidebar.classList.remove('open');
				mainSidebar.setAttribute('aria-hidden','true');
				toggle.setAttribute('aria-expanded','false');
				overlay.classList.remove('show');
				deactivateTrap(mainSidebar);
			}

			function openOther(){
				otherSidebar.classList.add('open');
				otherSidebar.setAttribute('aria-hidden','false');
				closeMain();
				closeCart();
				overlay.classList.add('show');
				activateTrap(otherSidebar);
			}

			function closeOther(){
				otherSidebar.classList.remove('open');
				otherSidebar.setAttribute('aria-hidden','true');
				overlay.classList.remove('show');
				deactivateTrap(otherSidebar);
			}

			// Small helper to show a temporary mobile toast/notice
			function showMobileToast(msg, duration = 1800){
				try{
					let el = document.getElementById('cart-mobile-toast');
					if(!el){
						el = document.createElement('div');
						el.id = 'cart-mobile-toast';
						el.style.cssText = 'position:fixed;left:12px;right:12px;bottom:18px;background:linear-gradient(90deg,#111,#222);color:var(--fg);padding:10px 14px;border-radius:10px;text-align:center;font-weight:700;z-index:95;box-shadow:0 8px 30px rgba(0,0,0,0.6)';
						document.body.appendChild(el);
					}
					el.textContent = msg;
					el.style.display = 'block';
					setTimeout(()=>{ try{ el.style.display = 'none'; }catch(e){} }, duration);
				}catch(e){/* no-op */}
			}

			function openCart(){
				cartSidebar.classList.add('open');
				cartSidebar.setAttribute('aria-hidden','false');
				closeMain();
				closeOther();
				overlay.classList.add('show');
				activateTrap(cartSidebar);
				renderCart(); // Always refresh cart content on open
				// Show mobile indicator when opening cart on small screens
				if(window.innerWidth <= 640){
					document.body.classList.add('cart-open-mobile');
					// ensure indicator element exists
					if(!document.getElementById('cart-mobile-indicator')){
						const el = document.createElement('div');
						el.id = 'cart-mobile-indicator';
						el.textContent = 'Cart Open ‚Äî Swipe down to continue shopping';
						document.body.appendChild(el);
					}
				}
			}
			function closeCart(){
				cartSidebar.classList.remove('open');
				cartSidebar.setAttribute('aria-hidden','true');
				overlay.classList.remove('show');
				deactivateTrap(cartSidebar);
				// Hide mobile indicator
				document.body.classList.remove('cart-open-mobile');
				const ind = document.getElementById('cart-mobile-indicator');
				if(ind) ind.remove();
			}

			// --- Data Maps ---

			const categoryMap = {
				stickers: [
					{label: 'SINGLE STICKERS', href: 'images/PINTEREST%20IMAGES/SINGLE%20STICKERS/'},
					{label: 'FULLPAGE STICKERS', href: 'images/PINTEREST%20IMAGES/FULLPAGE%20STICKERS/'}
				],
				bookmarks: [
					{label: 'BOOKMARK', href: 'images/PINTEREST%20IMAGES/BOOKMARK/'}
				],
				posters: [
						{label: 'AESTHETICS', href: 'outputs/AESTHETICS/'},
						{label: 'ANIME', href: 'outputs/ANIME/'},
						{label: 'CARS', href: 'outputs/CARS/'},
						{label: 'DC', href: 'outputs/DC/'},
						{label: 'DEVOTIONAL', href: 'outputs/DEVOTIONAL/'},
						{label: 'MARVEL', href: 'outputs/MARVEL/'},
						{label: 'MOTIVATIONAL', href: 'outputs/MOTIVATIONAL/'},
						{label: 'MOVIE POSTERS', href: 'outputs/MOVIE%20POSTERS/'},
						{label: 'SPLIT POSTERS', href: 'outputs/SPLIT%20POSTERS/'},
						{label: 'SPORTS', href: 'outputs/SPORTS/'}
				]
			};

			// Helper to generate sequential file lists
			function generateFileList(prefix, start, end, suffix = '.jpg', pad = 3){
				const list = [];
				for(let i=start; i<=end; i++){
					const num = String(i).padStart(pad, '0');
					list.push(prefix + num + suffix);
				}
				return list;
			}

			// Image probing helper: returns first working candidate URL or null
			function testImage(url){
				return new Promise(resolve => {
					try{
						const img = new Image();
						img.onload = () => resolve(true);
						img.onerror = () => resolve(false);
						img.src = url;
					} catch(e){ resolve(false); }
				});
			}

			async function findFirstWorking(candidates){
				for(const c of candidates){
					try{
						const ok = await testImage(c);
						if(ok) return c;
					} catch(e){ /* ignore */ }
				}
				return null;
			}


						// --- Manifest-based fileMap ---
						let fileMap = {};
						let manifestLoaded = false;
						function loadManifest(callback) {
								fetch('images/manifest.json')
									.then(r => r.json())
									.then(data => {
										fileMap = data;
										manifestLoaded = true;
										if (typeof callback === 'function') callback();
									})
									.catch(() => {
										manifestLoaded = false;
										// fallback: do nothing, or could use old generateFileList logic
									});
						}


			// --- Sidebar Population Logic ---

			// helper to populate other sidebar list by key
			function populateOther(key){
				if(!key || !categoryMap[key]) return;
				otherList.innerHTML = categoryMap[key].map(item=>
					// Use data-href and data-label instead of href to prevent navigation,
					// and rely on a delegated event listener to handle clicks
					`<li><a href="#" data-href="${item.href}" data-label="${item.label}"><span class="icon icon-other" aria-hidden><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 7h16v10H4z"/></svg></span>${item.label}</a></li>`
				).join('');

				// update right-sidebar title to a friendly label
				const otherTitle = document.getElementById('other-title');
				if(otherTitle){
					// make a display label: capitalize and replace dashes/underscores
					otherTitle.textContent = key.replace(/[-_]/g,' ').replace(/\b\w/g, c=>c.toUpperCase());
				}

				// animate list items with a small stagger
				const items = Array.from(otherList.querySelectorAll('li'));
				items.forEach((li, i)=>{
					li.style.opacity = '0';
					li.style.transform = 'translateX(10px)';
					li.style.transition = 'opacity .28s ease, transform .28s ease';
					setTimeout(()=>{
						li.style.opacity = '1';
						li.style.transform = 'translateX(0)';
					}, 60 * (i+1));
				});
			}

			// --- Catalog rendering & Cart logic ---

			const posterSizes = ['A4','A3','A5','A6','Pocket'];
			const stickerSizes = ['Single','Fullpage'];

			// Helpers: robust detection for sticker categories (labels may be plural or folder-based)
			function isSingleSticker(label, folderHref){
				const L = (label||'').toLowerCase();
				const F = (folderHref||'').toLowerCase();
				return (L.includes('single') && L.includes('stick')) || L.includes('single sticker') || L.includes('single stickers') || F.includes('single');
			}

			function isFullpageSticker(label, folderHref){
				const L = (label||'').toLowerCase();
				const F = (folderHref||'').toLowerCase();
				return L.includes('fullpage') || L.includes('full-page') || L.includes('full page') || L.includes('fullpage sticker') || L.includes('fullpage stickers') || F.includes('fullpage') || F.includes('full-page');
			}

			function renderCard(file, folderHref, label, i, resolvedSrc){
				const baseName = file.replace(/(_full)?\.(jpg|jpeg|png)$/i, '');
				const folderName = decodeURIComponent(folderHref.replace(/^outputs\//, '').replace(/\/$/, ''));
				let category = label;
				let defaultPrice = priceMap.posters.A4 || 59;
				let sizeSelector = '';
				let sizes = [];
				let defaultSize = 'A4'; // Default size for Posters

				if(folderHref.startsWith('outputs/')){
					sizes = posterSizes;
					defaultPrice = priceMap.posters.A4;
					defaultSize = 'A4';
					sizeSelector = `<div style="margin:8px 0"><label style="font-size:13px;color:var(--muted)">Size:</label> <select class="size-select" style="margin-left:6px;padding:6px 10px;border-radius:4px;background:#151515;color:var(--fg);border:1px solid rgba(255,255,255,0.06);">
						${sizes.map(size => `<option value="${size}" ${size===defaultSize?'selected':''} data-price="${priceMap.posters[size]}">${size} (‚Çπ${priceMap.posters[size]})</option>`).join('')}
					</select></div>`;
					category = 'Poster';
				} else if(isSingleSticker(label, folderHref)){
					sizes = ['Single'];
					defaultPrice = priceMap.stickers['Single'];
					category = 'Sticker';
				} else if(isFullpageSticker(label, folderHref)){
					sizes = ['A4 (Full)', 'A3 (Full)'];
					// Determine default price and size based on file name (A4 or A3)
					if(file.includes('A3')) {
						defaultPrice = priceMap.stickers['A3 (Full)'];
						defaultSize = 'A3 (Full)';
					} else {
						defaultPrice = priceMap.stickers['A4 (Full)'];
						defaultSize = 'A4 (Full)';
					}
					// Add dropdown for size selection
					sizeSelector = `<div style="margin:8px 0"><label style="font-size:13px;color:var(--muted)">Size:</label> <select class="size-select" style="margin-left:6px;padding:6px 10px;border-radius:4px;background:#151515;color:var(--fg);border:1px solid rgba(255,255,255,0.06);">
						${sizes.map(size => `<option value="${size}" ${size===defaultSize?'selected':''} data-price="${priceMap.stickers[size]}">${size} (‚Çπ${priceMap.stickers[size]})</option>`).join('')}
					</select></div>`;
					category = 'Sticker';
				} else if(label.toLowerCase().includes('bookmark')){
					sizes = ['Default'];
					defaultPrice = priceMap.bookmarks.Default;
					category = 'Bookmark';
				}


				// Improved image fallback for posters: try *_full.jpg if manifest file is missing
				let thumbHtml = '';
				let thumbSrc = resolvedSrc || (folderHref + file);
				let fallbackSrc = '';
				// If we have a manifest (fileMap) prefer the _full variant to avoid initial 404s
				try {
					if(folderHref.startsWith('outputs/')){
						const ext = (file.match(/\.(jpg|jpeg|png)$/i) || [])[0] || '.jpg';
						const base = file.replace(/\.(jpg|jpeg|png)$/i, '');
						const fullName = base + '_full' + ext;
						const folderKey = decodeURIComponent(folderHref.replace(/^outputs\//, '').replace(/\/$/, ''));
						if(fileMap && Array.isArray(fileMap[folderKey]) && fileMap[folderKey].includes(fullName)){
							thumbSrc = folderHref + fullName;
							fallbackSrc = '';
						} else {
							// fallback candidate
							fallbackSrc = folderHref + base + '_full' + ext;
						}
					}
				} catch(e) { /* ignore manifest errors */ }
				// Special logic for bookmarks: map BM-###.ext to outputs/BOOKMARK/BOO-###_full.jpg
				if(label.toLowerCase().includes('bookmark')) {
					// Try to match BM-###.ext to BOO-###_full.jpg
					const match = file.match(/^BM-(\d+)\.(jpg|jpeg|png)$/i);
					if(match) {
						const num = match[1].padStart(3, '0');
						thumbSrc = 'outputs/BOOKMARK/BOO-' + num + '_full.jpg';
						fallbackSrc = outputsFallback;
					}
				} else if(folderHref.startsWith('outputs/')) {
					// If file is AE-045.jpg, fallback to AE-045_full.jpg
					if(!/_full\.(jpg|jpeg|png)$/i.test(file)) {
						const ext = file.split('.').pop();
						const base = file.replace(/\.(jpg|jpeg|png)$/i, '');
						fallbackSrc = folderHref + base + '_full.' + ext;
					}
				}
				// For full page stickers, use a narrower width so the full image appears
				let imgStyle = "width:100%;height:100%;object-fit:cover;border-radius:6px;";
				   if(isFullpageSticker(label, folderHref)) {
					   imgStyle = "width:70%;height:100%;object-fit:contain;border-radius:6px;display:block;margin:0 auto;";
				   } else if(label.toLowerCase().includes('bookmark')) {
					   imgStyle = "width:100%;height:100%;object-fit:contain;border-radius:6px;display:block;margin:0 auto;";
				   }
				// If we already resolved a working src, don't attach onerror chaining; otherwise fall back as before
				if(resolvedSrc){
					thumbHtml = `<div class="thumb"><img src="${thumbSrc}" alt="${label} ${i+1}" loading="lazy" decoding="async" style="${imgStyle}"></div>`;
				} else {
					thumbHtml = `<div class="thumb"><img src="${thumbSrc}" alt="${label} ${i+1}" loading="lazy" decoding="async" style="${imgStyle}" onerror="if('${fallbackSrc}' && this.src !== '${fallbackSrc}') { this.onerror = null; this.src = '${fallbackSrc}'; } else if(this.src !== '${outputsFallback}') { this.onerror = null; this.src = '${outputsFallback}'; } else { this.style.display='none';this.parentElement.textContent='Image not available'; }"></div>`;
				}

				return `
					<div class="card" style="animation: itemEnter 260ms ease forwards ${50 * i}ms; opacity:0; transform:translateY(10px);">
						${thumbHtml}
						<div class="title">${baseName}</div>
						<div style="font-size:18px;font-weight:700">‚Çπ${defaultPrice}</div>
						${sizeSelector}
						<div class="actions">
							<button class="button"
								data-details="details"
								data-name="${baseName}"
								data-cat="${category}"
								data-price="${defaultPrice}"
								data-file="${file}"
								data-folder="${folderHref}"
								data-size="${defaultSize}"
								onclick="openDetails({id:'${folderName}-${file}', name:'${baseName}', category:'${category}', price:${defaultPrice}, file:'${file}', folder:'${folderHref}', size:'${defaultSize}'})"
							>View Details</button>
							<button class="button primary"
								data-add="add"
								data-name="${baseName}"
								data-cat="${category}"
								data-price="${defaultPrice}"
								data-file="${file}"
								data-folder="${folderHref}"
								data-size="${defaultSize}"
								onclick="window.addToCartFromCard(this)"
							>Add to Cart</button>
						</div>
					</div>
				`;
			}

				async function renderCatalog(folderOrKey, label){
				catalogGrid.innerHTML = '';
				let files = [];
				let folderHref = folderOrKey;
				let folderName = decodeURIComponent(folderHref.replace(/^outputs\//, '').replace(/\/$/, ''));

				if(folderHref.startsWith('outputs/')){
					files = fileMap[folderName] || [];
				} else if(folderHref.startsWith('images/')) {
					// For stickers/bookmarks, use the label to look up the file list
					let folderNameForMap = label.toUpperCase();
					// If this is a bookmark category, use outputs/BOOKMARK/ as the folder and fileMap
					if(label.toLowerCase().includes('bookmark')) {
						folderHref = 'outputs/BOOKMARK/';
						folderNameForMap = 'BOOKMARK';
					}
					files = fileMap[folderNameForMap] || [];
					folderName = folderNameForMap;
				}
				// If this is a stickers folder, normalize label to aid downstream checks
				if(isSingleSticker(label, folderHref)) label = 'SINGLE STICKERS';
				if(isFullpageSticker(label, folderHref)) label = 'FULLPAGE STICKERS';

				if(files.length === 0){
					catalogGrid.innerHTML = `<p style="color:var(--muted);text-align:center;padding:40px;">No items found for "${label}".</p>`;
					return;
				}

				// Prepare probe tasks for files and run them in parallel (bounded). This reduces the overall wall-clock time vs serial probing.
				const PROBE_WINDOW = Math.min(files.length, 200); // limit number concurrently probed
				const probeTasks = files.slice(0, PROBE_WINDOW).map(file => (async () => {
					const m = (file || '').match(/^(.*)\.(jpg|jpeg|png|webp|gif)$/i);
					if(!m) return null;
					const base = m[1];
					const ext = m[2];
					let candidates = [];
					if(label.toLowerCase().includes('bookmark')){
						const match = file.match(/^BM-(\d+)\.(jpg|jpeg|png)$/i);
						if(match){
							const num = match[1].padStart(3,'0');
							candidates.push('outputs/BOOKMARK/BOO-' + num + '_full.jpg');
							candidates.push('outputs/BOOKMARK/BOO-' + num + '.jpg');
						}
					} else if(folderHref.startsWith('outputs/')){
						candidates.push(folderHref + base + '_full.' + ext);
						candidates.push(folderHref + file);
					} else {
						candidates.push(folderHref + file);
					}
					try{
						const resolved = await findFirstWorking(candidates.map(c=>encodeURI(c)));
						if(resolved) return { file, resolvedSrc: resolved };
					} catch(e){ /* ignore */ }
					return null;
				})());

				const probeResults = await Promise.all(probeTasks);
				const validated = probeResults.filter(Boolean).slice(0,200);

				if(!validated.length){
					catalogGrid.innerHTML = `<p style="color:var(--muted);text-align:center;padding:40px;">No valid images found for "${label}".</p>`;
					return;
				}

				catalogGrid.innerHTML = validated.map((entry, i) => renderCard(entry.file, folderHref, label, i, entry.resolvedSrc)).join('');

				// Reattach event listeners to the newly rendered buttons (especially for the details button)
				attachCardListeners();
			}


			// Initial render: wait for manifest, then render.
			// If `category` query param is present, use it to show the requested category.
			loadManifest(() => {
				try{
					const params = new URLSearchParams(window.location.search);
					const catQ = (params.get('category') || '').trim();
					if(catQ){
						const cat = catQ.toLowerCase();
						if(cat.includes('bookmark')){
							// Show bookmarks (manifest key: BOOKMARK)
							renderCatalog('images/PINTEREST%20IMAGES/BOOKMARK/', 'BOOKMARK');
							return;
						}
						if(cat.includes('sticker')){
							// Default to single stickers when user clicks Stickers from index
							renderCatalog('images/PINTEREST%20IMAGES/SINGLE%20STICKERS/', 'SINGLE STICKERS');
							return;
						}
						// If the param looks like a manifest folder name, try to use it directly
						// e.g., ?category=AESTHETICS or ?category=MOVIE%20POSTERS
						const lookup = catQ.toUpperCase();
						if(fileMap && fileMap[lookup]){
							// render from outputs folder if present
							renderCatalog('outputs/' + lookup + '/', lookup);
							return;
						}
					}
				} catch(e){ /* ignore param parsing errors and fall back to default */ }
				// Default landing catalog
				renderCatalog('outputs/AESTHETICS/', 'AESTHETICS');
			});


			// Helper to get main category from item
			function getMainCategory(cat) {
				cat = cat.toLowerCase();
				if(cat.includes('poster') || cat === 'aesthetics' || cat === 'anime' || cat === 'cars' || cat === 'dc' || cat === 'devotional' || cat === 'marvel' || cat === 'motivational' || cat === 'movie posters' || cat === 'split posters' || cat === 'sports') return 'posters';
				if(cat.includes('sticker')) return 'stickers';
				if(cat.includes('bookmark')) return 'bookmarks';
				return ''; // Return an empty string or a default if not found
			}

			/**
			 * Determines the best applicable promotion tier for a given quantity.
			 * The best promo is defined as the one that yields the maximum number of free items.
			 * @param {number} q - The total quantity of an item.
			 * @returns {object} An object containing the calculation results.
			 */
			function computeBestPromo(q){
				let maxFreebies = 0;
				let bestPromo = null;
				
				// Define tiers: {buy: X, free: Y}
				const promoTiers = [
					{buy: 10, free: 5}, // Buy 10 Get 5 Free (Set size: 15)
					{buy: 5, free: 2},   // Buy 5 Get 2 Free (Set size: 7)
					{buy: 3, free: 1}    // Buy 3 Get 1 Free (Set size: 4)
				];

				for(const promo of promoTiers){
					const setSize = promo.buy + promo.free;
					
					// Calculate freebies for this specific promo tier
					// Only proceed if the quantity is enough for at least one full set
					if(q >= setSize) {
						const promoSets = Math.floor(q / setSize);
						const freebies = promoSets * promo.free;
							
						// Check if this tier gives more free items than the current best
						if(freebies > maxFreebies) {
							 maxFreebies = freebies;
							 bestPromo = promo;
						}
					}
				}
				
				// Construct the final result based on the best-performing promo
				if (maxFreebies > 0 && bestPromo) {
					const setSize = bestPromo.buy + bestPromo.free;
					const promoSets = Math.floor(q / setSize);
					return {
						bestPromo: bestPromo,
						promoSets: promoSets,
						freebies: maxFreebies,
						paidQty: q - maxFreebies, // Total quantity minus free items
						remQty: q % setSize
					};
				}
				
				// No promo applied
				return { bestPromo: null, promoSets: 0, freebies: 0, paidQty: q, remQty: q };
			}


			function renderCart(){
				cartItemsEl.innerHTML = '';
				let cartCount = 0;
				
				if(cart.length === 0){
					cartItemsEl.innerHTML = `<li style="text-align:center;color:var(--muted);padding:20px 0;">Your cart is empty.</li>`;
					cartTotalsEl.innerHTML = '';
					document.getElementById('cart-count').style.display = 'none';
					return;
				}

				// --- NEW PROMO LOGIC: GROUP BY MAIN CATEGORY ---
				
				// 1. Group all individual units by main category and populate originalTotal
				const categoryData = { posters: [], stickers: [], bookmarks: [] };
				let originalTotal = 0;
				let itemPromoMap = {}; // Key: item.key, Value: {paidQty: N, freeQty: M}

				cart.forEach(it => {
					cartCount += it.qty;
					originalTotal += it.price * it.qty;
					const mainCat = getMainCategory(it.category);
					
					if (categoryData[mainCat]) {
						// Expand item into individual units for price-based promotion calculation
						for (let i = 0; i < it.qty; i++) {
							categoryData[mainCat].push({
								key: it.key, // Reference back to the original cart item
								price: it.price,
								isPaid: true // Will be changed to false if marked free
							});
						}
					}
				});
				
				let totalDiscount = 0;
				let totalPrice = 0;
				let offerApplied = false;

				// 2. Apply promo per category, mark free units, and calculate final totals
				['posters', 'stickers', 'bookmarks'].forEach(mainCat => {
					let units = categoryData[mainCat];
					if (units.length === 0) return;
					
					const totalQty = units.length;
					const promoResult = computeBestPromo(totalQty);
					const freebies = promoResult.freebies;
					
					if (freebies > 0) {
						offerApplied = true;
						
						// Sort units by price ascending to give the freebie discount to the cheapest items first (fairest)
						units.sort((a, b) => a.price - b.price);
						
						// Mark the 'freebies' number of cheapest units as free
						for (let i = 0; i < freebies; i++) {
							units[i].isPaid = false;
							totalDiscount += units[i].price; // Discount is the price of the free item
						}
					}
					
					// 3. Accumulate final totals and map paid/free quantities back to original cart items
					units.forEach(unit => {
						if (!itemPromoMap[unit.key]) {
							itemPromoMap[unit.key] = { paidQty: 0, freeQty: 0 };
						}
						if (unit.isPaid) {
							itemPromoMap[unit.key].paidQty++;
							totalPrice += unit.price; // Add to final paid total
						} else {
							itemPromoMap[unit.key].freeQty++;
						}
					});
				});

				// --- END NEW PROMO LOGIC ---
				
				// 4. Render individual items using the calculated paid/free quantities
				cart.forEach(it=>{
					// Get calculated promo data for this item
					const promoData = itemPromoMap[it.key] || {paidQty: it.qty, freeQty: 0};
					const paidQty = promoData.paidQty;
					const freebies = promoData.freeQty;
					const promoSets = freebies > 0; // Check if any freebies were assigned
					
					// Calculate individual item display price (which is price * paidQty)
					const itemTotal = it.price * paidQty;

					let itemPriceHtml = `<div style=\"font-weight:700\">‚Çπ${itemTotal}</div>`;
					
					if(promoSets){
						const offerOrig = it.price * it.qty;
						itemPriceHtml = `<div style=\"font-weight:700\"><span style='text-decoration:line-through;color:#ffbdbd'>‚Çπ${offerOrig}</span> <span style='color:#9fd0a6'>‚Çπ${itemTotal}</span></div>`;
					}

					li = document.createElement('li');
					li.className='cart-item';
					
					// Debug info for freebies
					let debugHtml = '';
					if(freebies > 0) {
						debugHtml = `<div style='font-size:11px;color:#bdbdbd;margin-top:2px;'>[${freebies} of this item are free]</div>`;
					}
					
					li.innerHTML = `
						<div style=\"flex:1\">
							<div class=\"ci-name\">${it.name}</div>
							<div class=\"ci-cat\" style=\"font-size:12px;color:var(--muted)\">${it.category}</div>
							${it.size && it.size !== 'Default' ? `<div style='font-size:12px;color:var(--muted)'>Size: ${it.size}</div>` : ''}
						</div>
						<div style=\"text-align:right\">
							${itemPriceHtml}
							<div style=\"font-size:12px;color:var(--muted)\">
								Qty: <button class=\"button\" data-decr=\"${it.key}\">-</button> ${it.qty} <button class=\"button\" data-incr=\"${it.key}\">+</button>
							</div>
							${freebies ? `<div style=\"font-size:12px;color:#9fd0a6\">FREE: ${freebies}</div>` : ''}
							${debugHtml}
							<div style=\"margin-top:6px\"><button class=\"button\" data-remove=\"${it.key}\">Remove</button></div>
						</div>
					`;
					cartItemsEl.appendChild(li);
				});

				// 5. Update summary
				const savingsHtml = offerApplied ? `<div style="font-size:14px;color:#9fd0a6;font-weight:700;">You saved: ‚Çπ${totalDiscount}</div>` : '';
				
				cartTotalsEl.innerHTML = `
					<div style="display:flex;justify-content:space-between;font-size:14px;color:var(--muted)"><span>Total Items:</span> <span>${cartCount}</span></div>
					<div style="display:flex;justify-content:space-between;font-size:14px;color:var(--muted);margin-top:4px;"><span>Original Total:</span> <span style='text-decoration:${offerApplied ? 'line-through' : 'none'};'>‚Çπ${originalTotal}</span></div>
					${savingsHtml}
					<div style="display:flex;justify-content:space-between;font-size:24px;font-weight:800;margin-top:8px;"><span>Total:</span> <span style="color:${offerApplied?'var(--accent2)':'inherit'};">‚Çπ${totalPrice}</span></div>
				`;

				// Update cart count badge
				const cartCountEl = document.getElementById('cart-count');
				if(cartCount > 0){
					cartCountEl.textContent = cartCount;
					cartCountEl.style.display = 'block';
				} else {
					cartCountEl.style.display = 'none';
				}

				// Attach event listeners for cart quantity buttons
				document.querySelectorAll('#cart-items button').forEach(btn => {
					const key = btn.dataset.incr || btn.dataset.decr || btn.dataset.remove;
					if(btn.dataset.incr) btn.onclick = () => changeQty(key, 1);
					else if(btn.dataset.decr) btn.onclick = () => changeQty(key, -1);
					else if(btn.dataset.remove) btn.onclick = () => removeFromCart(key);
				});
			}


			function addToCart(item){
				// Use composite key: folder/category + file + size (if present)
				const key = (item.folder || item.category || '') + '/' + (item.file || item.img || '') + '/' + (item.size || 'A4');
				let existing = cart.find(c => c.key === key);
				if(existing){
					existing.qty += 1;
				} else{
					cart.push({...item, key, qty:1});
				}
				renderCart();
			}

			function removeFromCart(key){
				cart = cart.filter(i=>i.key!==key);
				renderCart();
			}

			function changeQty(key, delta){
				const it = cart.find(i=>i.key===key);
				if(!it) return;
				it.qty = Math.max(0, it.qty + delta);
				if(it.qty===0) removeFromCart(key);
				else renderCart();
			}
			
			// Global function to be used by card button
			window.addToCartFromCard = function(btn){
				const name = btn.dataset.name;
				const category = btn.dataset.cat;
				const file = btn.dataset.file;
				const folder = btn.dataset.folder;
				let price = Number(btn.dataset.price||0);
				let size = btn.dataset.size; // Use size from data attribute
				
				// Check for size selector if it's a poster (only posters have it on the card)
				if(folder.startsWith('outputs/')){
					const card = btn.closest('.card');
					const sizeSelect = card.querySelector('.size-select');
					size = sizeSelect?.value || 'A4';
					price = Number(sizeSelect.selectedOptions[0].dataset.price);
				}

				addToCart({
					id: `${category}-${file}`,
					name: name,
					category: category,
					price: price,
					file: file,
					folder: folder,
					size: size
				});
				// On desktop/tablet open cart automatically; on small phones show a toast instead
				if(window.innerWidth > 640){
					openCart();
				} else {
					showMobileToast('Added to cart');
				}
			}
			
			// --- Details Modal Logic ---
			
			// Inject modal HTML into the body
			const modalHtml = `
				<div id="detail-modal" aria-hidden="true" style="position:fixed;inset:0;display:none;z-index:120">
					<div style="position:absolute;inset:0;background:rgba(0,0,0,0.6)" id="detail-overlay"></div>
					<div style="position:relative;max-width:920px;margin:40px auto;background:var(--accent);border-radius:10px;padding:18px;box-shadow:0 10px 60px rgba(0,0,0,0.8);color:var(--fg);z-index:121;max-height:90vh;overflow:auto">
						<button id="detail-close" style="position:absolute;right:12px;top:12px;background:transparent;border:0;color:var(--muted);font-size:20px;cursor:pointer">‚úï</button>
						<div style="display:flex;gap:20px;">
							<div id="detail-image" style="flex:1;max-width:50%;position:relative;min-height:300px;background:#111;border-radius:8px">
								</div>
							<div style="flex:1;max-width:50%;overflow:auto">
								<h2 id="detail-title" style="margin-top:0">Product Name</h2>
								<p id="detail-desc" style="color:var(--muted)">Details...</p>

								<div id="detail-price" style="font-size:24px;font-weight:700;margin:16px 0"></div>

								<div id="detail-size" style="margin-bottom:16px">
									</div>

								<button id="detail-add-to-cart" class="button primary" style="font-size:16px;padding:10px 20px;width:100%">Add to Cart</button>
								<div style="margin-top:14px;font-size:12px;color:#ffecb3;background:#222;padding:8px 10px;border-radius:6px;">
									<strong>Disclaimer:</strong> Offers apply for every multiple of the required quantity (e.g., Buy 3 Get 1 Free applies across *all* items in the same category like Posters). Add more to your cart and save big on posters, stickers, and bookmarks!<br>
								</div>
							</div>
						</div>
					</div>
				</div>
			`;
			document.body.insertAdjacentHTML('beforeend', modalHtml);

			// Detail Modal DOM elements
			const detailModal = document.getElementById('detail-modal');
			const detailOverlay = document.getElementById('detail-overlay');
			const detailClose = document.getElementById('detail-close');
			const detailTitle = document.getElementById('detail-title');
			const detailDesc = document.getElementById('detail-desc');
			const detailImage = document.getElementById('detail-image');
			const detailPriceEl = document.getElementById('detail-price');
			const detailSizeEl = document.getElementById('detail-size');
			const detailAddBtn = document.getElementById('detail-add-to-cart');

			function openDetails(payload){
				closeCart(); closeMain(); closeOther(); // Close all sidebars

				// clear old content
				detailImage.innerHTML = '';
				detailSizeEl.innerHTML = '';
				detailDesc.textContent = payload.details || ''; // Assuming 'details' might exist, otherwise empty

				// Image logic (robust fallback, prefer outputs/_full variant)
				if(payload.file){
					const imgEl = document.createElement('img');
					imgEl.style.width = '100%';
					imgEl.style.height = 'auto';
					imgEl.style.maxHeight = '60vh';
					imgEl.style.objectFit = 'contain';
					imgEl.style.borderRadius = '8px';
					imgEl.style.display = 'block';
					imgEl.style.margin = '0 auto';

					// Primary try: relative path (payload.folder + payload.file)
					const folderPrefix = payload.folder || '';
					const fileName = payload.file || '';
					let imgPath = folderPrefix + fileName;

					// If not already a *_full image, prepare a `_full` fallback in the same folder
					let fallbackFull = '';
					const m = fileName.match(/^(.*)\.(jpg|jpeg|png)$/i);
					if(m && !/_full\.(jpg|jpeg|png)$/i.test(fileName)){
						const base = m[1];
						const ext = m[2];
						fallbackFull = folderPrefix + base + '_full.' + ext;
					}

					const fallbackGeneric = outputsFallback;

					// Chain onerror handlers to try: relative -> _full (if available) -> generic fallback
					imgEl.onerror = function(){
						try {
							if(fallbackFull && this.src !== fallbackFull){
								this.onerror = function(){
									if(this.src !== fallbackGeneric){ this.onerror = null; this.src = fallbackGeneric; }
									else { this.onerror = null; this.style.display='none'; detailImage.textContent='Image not available'; }
								};
								this.src = fallbackFull;
							} else if(this.src !== fallbackGeneric){
								this.onerror = null; this.src = fallbackGeneric;
							} else {
								this.onerror = null; this.style.display='none'; detailImage.textContent='Image not available';
							}
						} catch(e) {
							this.onerror = null; this.style.display='none'; detailImage.textContent='Image not available';
						}
					};

					// Performance: prefer eager decoding for modal images so they show quickly when opened
					imgEl.loading = 'eager';
					imgEl.decoding = 'async';
					imgEl.src = imgPath;
					detailImage.appendChild(imgEl);
				} else {
					detailImage.textContent = 'No image';
				}

				// Title and Price
				detailTitle.textContent = payload.name;
				
				// Size selector and price logic
				let sizes = [];
				let priceSource = null;
				let currentPrice = payload.price; // Start with the price determined by renderCard

				if(payload.folder && payload.folder.startsWith('outputs/')){
					sizes = posterSizes;
					priceSource = priceMap.posters;
				} else if(payload.category && isFullpageSticker(payload.category, payload.folder)){
					sizes = ['A4 (Full)', 'A3 (Full)'];
					priceSource = priceMap.stickers;
				} else if(payload.category && payload.category.toLowerCase().includes('bookmark')){
					sizes = ['Default'];
					currentPrice = priceMap.bookmarks.Default;
				} else if(payload.category && isSingleSticker(payload.category, payload.folder)){
					sizes = ['Single'];
					currentPrice = priceMap.stickers['Single'];
				}

				// Always show selector for full page stickers, or if multiple sizes
				if(sizes.length > 1 || (payload.category && isFullpageSticker(payload.category, payload.folder))){
					const sel = document.createElement('select');
					sel.className='size-select';
					sel.style.cssText = 'padding:8px 12px;border-radius:6px;background:#151515;color:var(--fg);border:1px solid rgba(255,255,255,0.06);';
					const defaultSize = payload.folder && payload.folder.startsWith('outputs/') ? 'A4' : 'A4 (Full)';
					sizes.forEach(size => {
						let price = priceSource[size] || currentPrice;
						const option = document.createElement('option');
						option.value = size;
						option.textContent = `${size} (‚Çπ${price})`;
						option.dataset.price = price;
						const isSelected = size === (payload.size || defaultSize);
						if(isSelected){
							option.selected = true;
							currentPrice = price;
						}
						sel.appendChild(option);
					});
					sel.onchange = function(){
						currentPrice = Number(this.selectedOptions[0].dataset.price);
						detailPriceEl.textContent = `‚Çπ${currentPrice}`;
						// Also update the add-to-cart button's price and size
						detailAddBtn.dataset.price = currentPrice;
						detailAddBtn.dataset.size = this.value;
					};
					detailSizeEl.innerHTML = `<label style="font-size:15px;font-weight:700">Size:</label><div style="margin-top:8px;"></div>`;
					detailSizeEl.querySelector('div').appendChild(sel);
					// Set initial data attributes for add-to-cart
					detailAddBtn.dataset.price = currentPrice;
					detailAddBtn.dataset.size = sel.value;
				}

				// Final price display update
				detailPriceEl.textContent = `‚Çπ${currentPrice}`;

				// Add-to-cart listener
				detailAddBtn.onclick = function(){
					// Get the current selected size from the dropdown, or use the payload size (for singles/bookmarks)
					const size = detailSizeEl.querySelector('select')?.value || payload.size || sizes[0] || null;
					let itemPrice = currentPrice;

					// Re-calculate price one last time based on final selection from selector if available
					if(detailSizeEl.querySelector('select')){
						itemPrice = Number(detailSizeEl.querySelector('select').selectedOptions[0].dataset.price);
					}

					const item = {...payload, price: itemPrice, size: size};
					addToCart(item);
					closeDetails();
					// On small screens avoid forcing the cart open; show toast instead
					if(window.innerWidth > 640){
						openCart();
					} else {
						showMobileToast('Added to cart');
					}
				}

				// Set modal visible and trap focus
				detailModal.style.display = 'block';
				detailModal.setAttribute('aria-hidden', 'false');
				activateTrap(detailModal.querySelector('div:nth-child(2)'));

				// Fix: Make sure the X (close) button works
				detailClose.onclick = closeDetails;
				detailOverlay.onclick = closeDetails;
			}

			function closeDetails(){
				detailModal.style.display = 'none';
				detailModal.setAttribute('aria-hidden', 'true');
				deactivateTrap(detailModal.querySelector('div:nth-child(2)'));
			}


			// --- Event Listeners ---

			// Main Sidebar Toggle
			toggle.addEventListener('click', function(){
				if(mainSidebar.classList.contains('open')) closeMain(); else openMain();
			});

			// Overlay Click
			overlay.addEventListener('click', function(){ closeMain(); closeOther(); closeCart(); closeDetails(); });

			// Global Escape fallback
			document.addEventListener('keydown', function(e){ if(e.key === 'Escape'){ closeMain(); closeOther(); closeCart(); closeDetails(); } });

			// Head Category Clicks
			document.querySelectorAll('.head-btn').forEach(btn => {
				btn.addEventListener('click', ()=>{
					const key = btn.dataset.key;
					if(key && categoryMap[key]){
						populateOther(key);
						openOther();
					}
				});
			});

			// Sub-Category (Other Sidebar) Clicks - Delegate event handling
			otherList.addEventListener('click', function(e){
				const link = e.target.closest('a[data-href]');
				if(link){
					e.preventDefault(); // Stop default navigation
					const folder = link.dataset.href;
					const label = link.dataset.label;
					
					// Change main catalog content
					renderCatalog(folder, label);
					
					// Close sidebar (optional, but good UX)
					closeOther();
					window.scrollTo({top:0,behavior:'smooth'}); // Scroll to top of content
				}
			});

			// Cart Button Clicks
			cartBtn.addEventListener('click', openCart);
			document.getElementById('back-to-shop').addEventListener('click', closeCart);
			document.getElementById('clear-cart').addEventListener('click', ()=>{
				if(confirm('Are you sure you want to clear your cart?')){
					cart = [];
					renderCart();
				}
			});

			// WhatsApp Share Logic
			document.getElementById('whatsapp-share').addEventListener('click', ()=>{
				if(!cart.length) { alert('Your cart is empty!'); return; }
				
				// --- START NEW PROMO CALCULATION FOR WHATSAPP ---
				const categoryData = { posters: [], stickers: [], bookmarks: [] };
				let itemPromoMap = {};
				
				cart.forEach(it => {
					const mainCat = getMainCategory(it.category);
					// Only process items in the main categories that have promotions
					if (categoryData[mainCat]) { 
						// Expand item into individual units
						for (let i = 0; i < it.qty; i++) {
							categoryData[mainCat].push({ key: it.key, price: it.price, isPaid: true });
						}
					}
				});
				
				let total = 0;

				['posters', 'stickers', 'bookmarks'].forEach(mainCat => {
					let units = categoryData[mainCat];
					if (units.length === 0) return;
					
					const totalQty = units.length;
					const promoResult = computeBestPromo(totalQty);
					const freebies = promoResult.freebies;
					
					if (freebies > 0) {
						// Sort units by price ascending to give the freebie discount to the cheapest items first (fairest)
						units.sort((a, b) => a.price - b.price); 
						for (let i = 0; i < freebies; i++) {
							units[i].isPaid = false;
						}
					}
					
					// Map paid/free quantities back to original cart items and calculate final total
					units.forEach(unit => {
						if (!itemPromoMap[unit.key]) {
							itemPromoMap[unit.key] = { paidQty: 0, freeQty: 0 };
						}
						if (unit.isPaid) {
							itemPromoMap[unit.key].paidQty++;
							total += unit.price; // Accumulate final paid total
						} else {
							itemPromoMap[unit.key].freeQty++;
						}
					});
				});
				// --- END NEW PROMO CALCULATION FOR WHATSAPP ---

				let msg = '*Order from Poster Point*%0A%0A';
				
				// Construct message from cart data using the calculated promo map
				cart.forEach(it => {
					const promoData = itemPromoMap[it.key] || { paidQty: it.qty, freeQty: 0 };
					const paidQty = promoData.paidQty;
					const freebies = promoData.freeQty;

					const itemTotal = it.price * paidQty;
					
					let itemDetails = `‚Ä¢ ${it.name} (${it.category}${it.size && it.size !== 'Default' ? ', ' + it.size : ''}) x${it.qty}`;
					if(freebies > 0){
						itemDetails += ` (x${freebies} FREE)`;
					}
					itemDetails += ` - Price: ‚Çπ${itemTotal}%0A`;
					
					msg += itemDetails;
				});
				
				msg += `%0A*Amount to Pay: ‚Çπ${total}*`;
				
				const phone = '7086743957';
				const url = `https://wa.me/${phone}?text=${msg}`;
				window.open(url, '_blank');
			});

			// Home Button Click
			document.getElementById('home-btn').addEventListener('click', ()=>{
				window.location.href = 'index.html';
			});

			// Utility function to attach card listeners (for details) - needed for dynamic rendering
			function attachCardListeners(){
				document.querySelectorAll('.card [data-details="details"]').forEach(btn => {
					btn.onclick = function(){
						const card = this.closest('.card');
						const sizeSelect = card.querySelector('.size-select');
						// Get the correct price/size for the initial view
						let price = Number(this.dataset.price);
						let size = this.dataset.size;
						if(sizeSelect){
							size = sizeSelect.value;
							price = Number(sizeSelect.selectedOptions[0].dataset.price);
						}
						const payload = { 
							id: `${this.dataset.cat}-${this.dataset.file}`, 
							name: this.dataset.name, 
							category: this.dataset.cat, 
							price: price, 
							file: this.dataset.file, 
							folder: this.dataset.folder,
							size: size
						};
						openDetails(payload);
					}
				});

				// Add price update for full page sticker size dropdown
				document.querySelectorAll('.card .size-select').forEach(select => {
					select.addEventListener('change', function(){
						const card = this.closest('.card');
						const price = this.selectedOptions[0].dataset.price;
						const priceDiv = card.querySelector('div[style*="font-size:18px"]');
						if(priceDiv) {
							priceDiv.innerHTML = `‚Çπ${price}${this.options.length > 1 ? '+' : ''}`;
						}
						// Also update the Add to Cart and Details button data-price and data-size
						const addBtn = card.querySelector('button[data-add="add"]');
						const detailsBtn = card.querySelector('button[data-details="details"]');
						if(addBtn) {
							addBtn.dataset.price = price;
							addBtn.dataset.size = this.value;
						}
						if(detailsBtn) {
							detailsBtn.dataset.price = price;
							detailsBtn.dataset.size = this.value;
						}
					});
				});
			}

			// Expose utility functions globally for inline HTML event handlers to work (e.g., onclick="openDetails(...)")
			// This is needed for the card buttons generated in renderCard
			window.openDetails = openDetails;
			
		})();
	</script>
	<script src="js/app.shop.js" defer></script>
</body>
</html>